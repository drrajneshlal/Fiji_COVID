%final
close all
clc

%comparision of observed infected cases and model estimation
%y1 is the observed daily observed cases and y2 is the output from epiestim
%y2=R_t*lambda_t

lambda=[2.640684971
6.771631668
5.696294659
3.581283997
4.256894484
2.701084074
2.521075944
1.512706835
1.970789391
1.184839965
2.655252248
3.208870473
1.595246833
4.195800146
3.397872093
2.187399812
6.792479644
7.23971194
5.213748745
3.199614075
1.982297635
4.177811932
3.125970569
3.595344894
6.994268158
3.764342338
4.392969402
15.66780604
11.90755961
7.036995653
13.65193683
19.00287325
21.66930567
31.31725574
22.74975227
22.14071182
28.63291301
30.30245693
31.17590269
28.64987824
31.09090062
31.27666679
54.31737701
54.99029659
69.66043724
49.50312791
44.17860065
47.95862273
45.93693687
72.4729036
75.7748567
90.52820607
99.79234179
90.34429512
99.23062489
119.5111289
135.4349762
124.6253114
146.5491767
201.6191641
233.7672465
210.8138493
228.5764273
236.1170211
230.9240471
263.0282142
259.6385763
331.6110507
349.7600281
351.5755477
418.4241063
370.137636
484.2821062
603.487775
622.5721156
701.8619519
579.5153023
528.1508382
688.5299569
647.593637
628.0386202
892.811334
1084.337345
1065.439835
1010.73612
882.9689089
961.2336585
1009.486894
949.6382164
723.7027805
733.9182628
705.6790515
987.9779252
835.8198885
934.9008275
1090.641938
1090.583771
1078.784957
858.0350023
987.8382063
1091.703365
1115.113348
1028.955709
900.8510705
818.8856128
770.4671445
719.4307272
537.1208444
596.769005
533.0587058
611.3822183
486.3953357
502.8154534
452.0859398
536.1487448
594.5287312
674.4409292
573.0177585
405.0738155
387.1670757
505.6898917
413.4883886
353.6013879
405.5590955
321.8174596
309.8237051
365.4409889
286.4575224
400.3301863
345.7078968
305.140518
291.314364
259.3120685
223.9657833
194.4324816
193.9630444
226.7754092
209.0683201
184.4243803
173.9450406
161.1942113
153.7328251
150.8059806
154.8276689
178.4053528
157.1992629
161.9885502
126.2640256
130.5821824
129.8063227
106.9927444
145.1415572
120.8112107
141.8502811
101.3628773
84.04128941
82.4396577
87.26829188
82.73814421
97.02946625
70.59266011
57.98552304
46.92915523
53.51814298
57.58030717
59.65994227
51.90635643
56.40018399
48.71820774
45.33088805
34.53180829
44.80936163
48.2681976
51.53315855
48.79005542
47.81006102
48.37501564
41.65433058
37.07811544
34.58896253
34.56529491
33.70311664
32.14134261
30.37961628
27.16941104
26.11177238
28.15704478
27.78050265
28.39312858
24.44700647
20.05925483
17.70867918
16.47088472
17.4700576
17.58051331
16.06149957
12.6013293
15.66576629
20.79519797
27.28399913
23.13169923
23.16294035
18.81208243
14.34495132
13.8568434
14.32362791
15.17653614
10.8017826
8.986108707
7.658129342
7.34121269
6.999745692
6.686842987
6.429056716
6.216481982
7.412054548
7.813335355
7.028705161
5.810285641
7.13621287];

%    Rt mean	1 sd
R_t=[
1.435069064	2.928508169	2.116620434
1.144028666	2.258840682	1.655006557
0.992010508	1.939161936	1.426713742
0.809579736	1.633162279	1.186004946
0.838992245	1.674012187	1.221198164
0.841562746	1.661633333	1.217444897
0.693523499	1.432496475	1.030224911
0.432449681	1.057828903	0.711062083
0.324417351	0.954041755	0.598074383
0.484910943	1.325090377	0.853706824
0.467813432	1.323594688	0.841706328
0.452674651	1.331218927	0.834521061
0.732050208	1.834616783	1.221665906
0.797860494	1.869114879	1.27787389
0.67640462	1.617903818	1.097108054
1.177377595	2.349180763	1.713736171
1.078905607	2.051625701	1.526966748
0.909905201	1.730257849	1.287781783
0.878467063	1.656391464	1.23719875
0.657973073	1.327326706	0.963906684
0.786624248	1.537677058	1.131326347
0.793650542	1.536607469	1.135067506
0.56678787	1.201786325	0.855114339
0.684836781	1.414553763	1.017320845
0.606169093	1.303676689	0.922283021
0.756933109	1.544653738	1.116420196
1.586850561	2.641158697	2.081023245
1.177605618	1.920737431	1.526841395
1.01344592	1.646770592	1.311223158
1.218909754	1.878199349	1.531033013
1.251569455	1.858868221	1.540445601
1.375999663	1.953279863	1.652196569
1.514642346	2.052876933	1.773685697
1.093389494	1.497708579	1.28771872
1.119417601	1.515826392	1.310224716
1.264762338	1.667353538	1.459207824
1.175509422	1.535590006	1.349625125
1.106929353	1.439031671	1.267614878
1.035498027	1.346169431	1.185814345
0.946047292	1.238167671	1.087267293
1.018839222	1.321443391	1.165295402
1.252471437	1.578420311	1.410802295
1.189675902	1.484124662	1.332889473
1.283113775	1.571769096	1.423833289
1.11578823	1.366801208	1.238157097
1.084542329	1.324644655	1.201635475
1.079677345	1.313387782	1.19371137
1.057703116	1.283266357	1.167798515
1.069936206	1.291950662	1.178364438
1.078912722	1.296257407	1.185127554
1.075411677	1.286544013	1.178646085
1.215609556	1.433724032	1.322448937
1.19006945	1.393826518	1.289963787
1.202666679	1.397873731	1.298460982
1.273128044	1.46428549	1.367058922
1.220998115	1.397022459	1.307549441
1.164561159	1.328561078	1.245229584
1.171191416	1.330100427	1.249399954
1.278473697	1.438315102	1.357233944
1.357919514	1.512860013	1.434358023
1.266145058	1.40514499	1.334752697
1.242068139	1.372893869	1.30667356
1.209437847	1.33282605	1.270393193
1.202557406	1.320931644	1.26105956
1.203315089	1.317323966	1.259683459
1.112970568	1.218567041	1.165178883
1.151735537	1.257183721	1.203890281
1.192763032	1.296947346	1.244317467
1.167394251	1.266569433	1.216483436
1.222380106	1.320625305	1.271034597
1.170706916	1.262756133	1.216302107
1.236838054	1.328502153	1.28226618
1.328211319	1.418888099	1.373180611
1.269310398	1.352497982	1.310578706
1.294193488	1.374213143	1.333907418
1.19921006	1.272305822	1.235491366
1.117272779	1.185671731	1.151221751
1.217740363	1.288076125	1.252664805
1.128201512	1.193290077	1.16052077
1.050662431	1.112304677	1.081266935
1.156707655	1.221159648	1.188718241
1.204961433	1.268768836	1.236662197
1.245494653	1.307817542	1.276468531
1.235760077	1.295021927	1.2652199
1.122051447	1.176213719	1.148975202
1.151685129	1.205674324	1.17852727
1.165572299	1.21854657	1.191914306
1.057979246	1.107047032	1.082376024
0.916382868	0.961898592	0.939004734
0.892246755	0.938391819	0.915175864
0.873776702	0.920654648	0.897064672
1.001329994	1.052751407	1.026881978
0.92889529	0.97800975	0.953296542
0.942841248	0.992843984	0.967683349
1.019209232	1.071505065	1.045195858
1.109480448	1.163363994	1.136264713
1.11337565	1.165759622	1.139419185
1.057162569	1.106880744	1.081880818
1.007154408	1.055149082	1.031014027
1.079765447	1.129440871	1.104465437
1.059052302	1.107353863	1.083070302
0.987935677	1.034020485	1.010848572
0.940318128	0.985484501	0.962770704
0.904158264	0.949056256	0.92647314
0.942336197	0.989038674	0.965548192
0.881519221	0.9270054	0.90412125
0.771862349	0.815352023	0.793460253
0.740939188	0.785550376	0.763084018
0.707937015	0.753645732	0.730615101
0.758122206	0.807780858	0.782757337
0.727047692	0.777230618	0.751932708
0.739961415	0.792554303	0.766035281
0.727292802	0.781193666	0.754005716
0.865659203	0.926485136	0.895817583
0.888353667	0.949966536	0.918905449
0.990245942	1.055258779	1.022497553
0.913414868	0.97472137	0.943822649
0.892719431	0.95364738	0.92293547
0.869004705	0.929792703	0.899145376
0.962155538	1.027093563	0.994363136
0.871102803	0.93248294	0.901535269
0.791149399	0.850713669	0.820665042
0.742650984	0.802496781	0.772288012
0.718102151	0.779566608	0.748523261
0.803730378	0.87159913	0.837325653
0.86588818	0.937536705	0.901361369
0.723990272	0.789898695	0.756590562
0.86946437	0.944767277	0.906730319
0.888172498	0.964473349	0.925935343
0.821518843	0.895082194	0.857911683
0.876958727	0.954561502	0.915354559
0.863937491	0.941493158	0.902304402
0.779192386	0.853769861	0.816060996
0.805472098	0.883822625	0.844199104
0.675605732	0.749175677	0.711922039
0.72560675	0.806107448	0.765335131
0.735745006	0.819660907	0.777144377
0.713062152	0.798223997	0.755050947
0.727028542	0.816109153	0.770934318
0.751813652	0.845141382	0.797804495
0.786193273	0.883834889	0.834309637
0.789147799	0.888527185	0.838111058
0.743857276	0.842117853	0.792236266
0.803557952	0.90870122	0.855332811
0.815629345	0.922971217	0.868482408
0.850695829	0.961601699	0.905311198
0.817348334	0.926723393	0.871189349
0.838327507	0.950879322	0.89372962
0.844755731	0.958989564	0.900979783
0.792946626	0.904883979	0.848004411
0.811693154	0.927690104	0.86873681
0.800549263	0.917823145	0.858198257
0.832135983	0.954037059	0.892059593
0.823953527	0.946667361	0.884260594
0.771474957	0.892089586	0.830702629
0.753255349	0.875907197	0.813441148
0.809864003	0.940796386	0.874121123
0.696124076	0.819495183	0.756569349
0.777236648	0.913206493	0.843870901
0.630684687	0.755943209	0.691915903
0.673343489	0.810307373	0.740263039
0.674445353	0.816947608	0.744013675
0.693097185	0.84271606	0.766105016
0.683708631	0.836840261	0.758367962
0.702784511	0.863034104	0.780881645
0.596538186	0.748839243	0.67055574
0.709006607	0.883868752	0.794063343
0.742539389	0.924711028	0.831163256
0.798667627	0.989668351	0.891645228
0.72116992	0.903582087	0.809842512
0.746468189	0.937047596	0.83908883
0.752288881	0.947308679	0.84703007
0.820999868	1.02789946	0.92158552
0.790506484	0.993864335	0.889318054
0.835464691	1.04678649	0.938190579
0.87010464	1.085841418	0.975029708
0.908522191	1.127622344	1.015156503
0.829223018	1.036676911	0.930096816
0.784988717	0.989677256	0.884411842
0.746847409	0.951407865	0.846077862
0.738859133	0.948547278	0.840477181
0.718357673	0.931184859	0.821370512
0.683032176	0.897420274	0.786622797
0.687616174	0.910979838	0.795429729
0.702626067	0.935728817	0.815065897
0.737760148	0.982518958	0.855822415
0.738255478	0.987024971	0.858192695
0.753561119	1.009108607	0.876740936
0.731976735	0.987660004	0.855103048
0.698955492	0.954553003	0.821851196
0.693069403	0.955321972	0.819015917
0.677906906	0.945066761	0.806024492
0.650739267	0.921196556	0.780184088
0.636619378	0.914393165	0.769318694
0.586862285	0.864837288	0.719220772
0.55952934	0.845420868	0.695220107
0.645703718	0.967022118	0.798383042
0.781196695	1.138735771	0.951678563
0.946964993	1.331671861	1.131247867
0.902773241	1.261592202	1.074793219
0.919441786	1.272928388	1.089108132
0.889203252	1.229693212	1.052654755
0.878460007	1.213496888	1.039316445
0.829501066	1.153675939	0.985007389
0.756261182	1.069121934	0.906026974
0.651444132	0.95126456	0.794372378
0.5984732	0.902213616	0.742677626
0.512432403	0.812808852	0.654106077
0.496527484	0.81620675	0.646609081
0.530497836	0.882962145	0.695704029
0.511432328	0.875366391	0.681394978
0.464471096	0.832095566	0.635137817
0.388097443	0.75140556	0.555051341
0.449208127	0.869723545	0.642450955
0.539002454	1.016314785	0.759110035
0.624693376	1.142159475	0.864283343
0.639903917	1.161780261	0.881758221
0.626689167	1.145808484	0.867044584
0.69542092	1.245839987	0.95094857
0.741997439	1.305000607	1.003997592];

 y1=[2
3
1
8
0
1 % before first Rt 
4
12
6
2
5
1
2
0
2
0
4
4
0
7
3
1
12
9
4
1
0
6
2
4
11
1
5
29
11
3
21
27
28
46
18
23
37
35
35
28
35
33
83
64
94
35
39
51
44
104
88
116
121
90
115
150
166
126
180
279
299
215
266
262
241
312
274
431
404
386
522
352
636
791
721
860
506
485
873
647
634
1220
1405
1180
1043
784
1054
1091
918
468
684
626
1285
715
1057
1301
1163
1121
632
1100
1220
1187
968
752
682
657
603
264
568
398
644
314
467
350
590
653
781
485
198
303
591
302
255
423
205
258
396
184
505
290
250
253
200
156
128
160
240
179
143
143
128
127
131
146
197
132
161
79
121
118
72
177
93
161
54
52
65
81
70
107
38
34
22
49
55
58
40
57
37
37
17
50
50
55
46
46
48
33
29
28
31
30
28
26
21
22
28
26
28
19
13
12
12
16
16
13
7
17
26
36
21
24
14
8
11
13
15
5
5
4
5
5
5
5
5
8
8
6
4
8
];
chek=length(y1)
t=8:1:227;
R=R_t(:,3);
y2=R.*lambda; %mean

t2 = datetime(2021,4,20) + caldays(0:219); %time for Rt  %orig datetime(2021,4,26) so shifted 5 days back 
t_obs=datetime(2021,4,14) + caldays(0:225); %time for observed cases initial date 19 - 5=14

 t=datenum(t2);
 tobs=datenum(t_obs);
sf=12;
figure('Units','inches','Position',[0,0,8,8],'PaperPositionMode','auto')
 subplot(2,1,1)
 ax = gca
%  ax = axes;
h=bar(tobs,y1,'barwidth',1)
h.EdgeColor = 'black';
hold on



plot(t2,y2,'r-','linewidth',1.5)



ax.TickDir = 'out';
   NumTicks = 35;
 L = get(gca,'XLim');
 set(gca,'XTick',linspace(L(1),L(2),NumTicks))
   datetick('x','dd mmm','keeplimits','keepticks')
    
%   start = datenum(2021,04,07);
% fin=datenum(2021,12,03);
%  datetick('x','dd mmm')
   
  set(gca,'XTickLabelRotation',90);
set(gca,'box','off','Units','normalized','YTick',0:300:1500,...
   'FontUnits','points','FontWeight','normal','FontSize',sf,'FontName','Times')

xlabel('Date (in 2021)','FontUnits','points','interpreter','latex','FontSize',sf,'FontName','Times')
ylabel('Daily incidence','FontUnits','points','interpreter','latex','FontSize',sf,'FontName','Times')
ttl=title('Epidemic curve','Interpreter','latex','HorizontalAlignment','left','FontUnits','points','FontWeight','normal','FontSize',sf,'FontName','Times')
ttl.Units = 'Normalize'; 
ttl.Position(1) = 0; % use negative values (ie, -0.1) to move further left
ttl.HorizontalAlignment = 'left';  ent = 'left';

% Set the tick direction
% 
%Epidemic curve for confirmed COVID-19 cases in Fiji, as of xxxxx
 legend('Reported confirmed number of cases', 'Model fitted'); %legend of 1,3  
  legend boxoff
 
hold off

%find R square to test model fitting y1 is from 7th as Rt is comouted on 7
%day sliding window
SStot = sum((y1(7:end) - mean(y1(7:end))).^2)  ;    % Compute R-squared
SSres = sum((y1(7:end)- y2).^2) ;

Rsq   = 1 - (SSres/SStot)


 subplot(2,1,2)
 ax = gca

 

 
y1=R_t(:,3); %mean 1
e1=R_t(:,1); %5 %
e2=R_t(:,2); % 95%
y1=y1';
e1=e1';
e2=e2';
err = [e2; e1];  
col = [0.7 0.7 0.7];

 h(1)=patch([t, fliplr(t)], [err(1,:), fliplr(err(2,:))], 'k', 'FaceAlpha',0.5,'EdgeColor',col, 'FaceColor', col) 
 hold on 
 h(2)=plot(t2, y1,'k','linewidth',1.5) 
   
%  y=[y1;e2;e1];
%  plot_ci(t,y, 'PatchColor', 'k', 'PatchAlpha', 0.2, ...
%            'MainLineWidth', 1.5, 'MainLineColor', 'k', ...
%            'LineWidth', 0.1, 'LineStyle','-', 'LineColor', 'none');


 hold on
 h(3)=plot(t2,1*ones(size(t2)),'b--','linewidth',1.5)
 
 NumTicks = 35;
L = get(gca,'XLim');
set(gca,'XTick',linspace(L(1),L(2),NumTicks))
   datetick('x','dd mmm','keeplimits','keepticks')
     
  set(gca,'XTickLabelRotation',90);
 
  set(gca,'box','off','Units','normalized','YTick',0:0.5:3,...
    'FontUnits','points','FontWeight','normal','FontSize',sf,'FontName','Times')
 xlabel('Date (in 2021)','FontUnits','points','interpreter','latex','FontSize',sf,'FontName','Times')
 ylabel('Reproduction number ($R$)','FontUnits','points','interpreter','latex','FontSize',sf,'FontName','Times')
 legend(h([2 1]),{'Mean','95%Crl'},'FontUnits','points','interpreter','latex','FontSize',sf,'FontName','Times','Location','best')

 legend boxoff

ttl=title('Estimated $R$','Interpreter','latex','HorizontalAlignment','left','FontUnits','points','FontWeight','normal','FontSize',sf,'FontName','Times')
ttl.Units = 'Normalize'; 
ttl.Position(1) = 0; % use negative values (ie, -0.1) to move further left
ttl.HorizontalAlignment = 'left';  ent = 'left';
hold off

 set(gcf, 'Renderer', 'Painters');
 
print -depsc2 epidemic.eps
 
 
%  SStot = sum((y1 - mean(y1)).^2)  ;    % Compute R-squared
% SSres = sum((y1- y2).^2) ;
% 
% Rsq   = 1 - (SSres/SStot)

% figure('Units','inches','Position',[0,0,8,6],'PaperPositionMode','auto')
% 
% 
% y=[y1;e2;e1];
% plot_ci(t,y, 'PatchColor', 'r', 'PatchAlpha', 0.2, ...
%           'MainLineWidth', 1.5, 'MainLineColor', 'r', ...
%           'LineWidth', 0.1, 'LineStyle','-', 'LineColor', 'none');  
%        
%   NumTicks = 35;
% L = get(gca,'XLim');
% set(gca,'XTick',linspace(L(1),L(2),NumTicks))
%    datetick('x','dd mmm','keeplimits','keepticks')
%      
%   set(gca,'XTickLabelRotation',90);
%    grid on;      
%    
%    
